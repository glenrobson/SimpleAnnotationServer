<html lang="en"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:p="http://primefaces.org/ui"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

    <ui:composition template="WEB-INF/templates/collectionBarLayout.xhtml">
        <ui:param name="title" value="Manifest Details"></ui:param>
        <ui:param name="path" value="/"></ui:param>
        <ui:define name="main">
            <c:set var="collection" value="#{storeService.getCollection(param['collection'], request)}" scope="request" />
            <c:set var="deleteStyle" value="inline-block" scope="request" />
            <c:if test="collection.default">
                <c:set var="deleteStyle" value="none"/>
            </c:if>

            <!--<button type="button" id="deleteCollection" class="close" data-mode="delete_collection" onclick="showConfirm(event);" style="#{deleteStyle}"><i class='far fa-window-close'></i></button>-->
            
            <div class="header_bar">
                <h1 id="collectionName"><h:outputText value="#{collection.label}"/></h1>
                <a href="#"><i class="far fa-question-circle"></i></a>
            </div>    
            <div class="options">
                <div class="option_links">
                    Collection options:
                    <a type="button" id="indexButton" href="#" data-toggle="modal" data-target="#addManifest"  onclick="hideMessage('addManifestMessages');"><i class="fas fa-plus-circle"></i> Add IIIF manifest (URL)</a> |

                    <a id="renameCollectionButton"  href="#" data-toggle="modal" data-target="#renameCollection" ><i class="fas fa-pen"></i> Rename collection</a>
                    <c:if test="#{not collection.defaultCollection}"> |
                        <a id="removeCollectionButton" href="#" data-mode="delete_collection" data-label="#{collection.label}" data-url="#{collection.id}" onclick="showConfirm(event);"><i class="fas fa-trash"></i> Delete collection</a>
                    </c:if>
                </div>    
                <div id="collectionCS">
                    <ui:include src="WEB-INF/templates/content-state.xhtml">
                        <ui:param name="url" value="#{collection.id}" />
                        <ui:param name="text" value="Collection Link" />
                        <ui:param name="description" value="Link to collection. Also draggable using IIIF Content State." />
                        <ui:param name="mode" value="full" />
                    </ui:include>
                </div>

                <!--<ui:include src="WEB-INF/templates/content-state.xhtml">
                    <ui:param name="url" value="#{collection.id}" />
                    <ui:param name="description" value="Link to collection. Also draggable using IIIF Content State." />
                    <ui:param name="mode" value="full" />
                </ui:include>-->
            <!--<p>These manifests have been annotated but not indexed. You can download annotations but its not possible to see stats or use the IIIF Search API. To index one of these manifests upload the manifest <a href="uploadManifest.xhtml">here</a>.</p>-->
            </div>
            <hr/>
            <ul id="manifests" class="media-list">
                <c:forEach items="#{collection.manifests}" var="manifest" varStatus="iterMetadata">
                    <li class="manifestSummary" id="#{manifest.shortId}">
                        <div class="media-header-div">
                            <h3 class="box_type">   
                                Manifest
                            </h3>
                            <ui:include src="WEB-INF/templates/content-state.xhtml">
                                <ui:param name="url" value="#{manifest.URI}" />
                                <ui:param name="description" value="Link to Manifest. Also draggable using IIIF Content State." />
                                <ui:param name="mode" value="full" />
                            </ui:include>
                        </div>
                        <div class="media-heading">
                            <c:set var="logo" value="#{manifest.logo}" scope="request" />
                            <img id="logo-#{manifest.shortId}" class="logo" src="#{logo}"/>
                            <h5>
                                <c:if test="#{not empty manifest.label}">
                                    <h:outputText value="#{manifest.label}"/>
                                </c:if>
                                <c:if test="#{empty manifest.label}">
                                    Missing Manifest label
                                </c:if>
                            </h5>
                        </div>
                        <div class="media">
                            <a href="view.xhtml?collection=#{collection.id}&amp;manifest=#{manifest.URI}" class="align-self-center">
                                <img id="thum-#{manifest.shortId}" src="" class="align-self-center mr-3 media-img" />
                            </a>
                            <div class="media-body">
                                <a href="view.xhtml?collection=#{collection.id}&amp;manifest=#{manifest.URI}" class="btn btn-primary mb-2" title="Open manifest for editing"><i class="far fa-edit"></i> Annotate in Mirador</a>
                                <a href="manifest.xhtml?iiif-content=#{manifest.URI}&amp;collection=#{collection.id}" class="btn btn-secondary mb-2" title="Export"><i class="fas fa-eye"></i> Browse Annotations</a>
                                <p id="desc-#{manifest.shortId}"><h:outputText value="#{manifest.description}"/></p>
                                <p id="attr-#{manifest.shortId}"><h:outputText value="#{manifest.attribution}"/></p>
                                <div id="actionBar">
                                    <span>
                                        <a href="#" class="actionLink" data-manifest-id="#{manifest.URI}" data-manifest-label="#{manifest.label}" data-collection-id="#{collection.id}">Share</a> | 
                                        <a href="#" class="actionLink" title="Move manifest to another collection." data-manifest-id="#{manifest.URI}" data-manifest-label="#{manifest.label}" data-collection-id="#{collection.id}" onClick="showMoveManifest(event)">Move to different collection</a> | 
                                        <a href="stats/manifest.xhtml?iiif-content=#{manifest.URI}" class="actionLink" title="Analytics">View progress</a> | 
                                        <a href="#" class="actionLink" aria-hidden="true" data-mode="remove_manifest" data-manifest="#{manifest.URI}" data-label="#{manifest.label}" data-collection-label="#{collection.label}" data-collection-id="#{collection.id}" onclick="showConfirm(event)">Remove manifest</a>
                                    </span>
                                                                    </div>
                            </div>
                        </div>
                        
                      <!--  <a href="annotations.xhtml?uri=#{manifest.URI}">
                            <c:if test="#{not empty manifest.label}">
                                <h:outputText value="#{manifest.label}"/>
                            </c:if>
                            <c:if test="#{empty manifest.label}">
                                <h:outputText value="#{manifest.URI}"/>
                            </c:if>
                        </a>-->
                        <script>
                            populateManifest("#{manifest.URI}", "#{manifest.shortId}");
                        </script>
                    </li>
                </c:forEach>
            </ul>
        <script>
            //initCollections('/inbox.json');
        </script>
        <ui:include src="WEB-INF/templates/dialogues/createCollection.xhtml"/>
        <ui:include src="WEB-INF/templates/dialogues/renameCollection.xhtml"/>
        <ui:include src="WEB-INF/templates/dialogues/addManifest.xhtml"/>
        <ui:include src="WEB-INF/templates/dialogues/moveManifest.xhtml"/>
        <ui:include src="WEB-INF/templates/dialogues/confirm.xhtml"/>
        </ui:define>
    </ui:composition>
</html>

